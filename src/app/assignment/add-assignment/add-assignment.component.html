<div class="spinner-overlay" *ngIf="showSpinner">
  <mat-spinner diameter="50"></mat-spinner>
</div>
<form [formGroup]="assignmentForm" (ngSubmit)="onSubmit()">
  <div class="header-label-container">
    <mat-icon class="action-mat-icon" aria-label="back" (click)="navigateBack()">keyboard_backspace</mat-icon>
    <span class="title">
      Assignment</span>
  </div>

  <mat-divider></mat-divider>
  <mat-card class="shipping-card">
    <mat-card-header>
      <mat-card-title>
        {{assignmentData ? 'Edit' : 'Add'}} Assignment
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <!-- Company -->
      <div class="form-panel">
        <mat-accordion>
          <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Company
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="form-body">
              <div class="row">
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Medical Member</mat-label>
                    <mat-select formControlName="medicalId" (selectionChange)="handleMedicalSelect($event)">
                      <mat-option *ngFor="let medical of medicalTeams" [value]="medical.pid"
                        [disabled]="medical.approved === '0'">{{medical.first_name +
                        ' ' +medical.last_name }}</mat-option>
                    </mat-select>
                    <mat-error
                      *ngIf="assignmentForm.get('medicalId')?.invalid && assignmentForm.get('medicalId')?.touched">
                      Medical Member is invalid
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Medical Profession</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="medicalProfession">
                    </div>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>

      <!-- Assignment -->
      <div class="form-panel">
        <mat-accordion>
          <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Assignment
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="form-body">
              <div class="row">
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Assignment</mat-label>
                    <!-- <div class="uname-input">
                      <input matInput formControlName="assignment">
                    </div> -->
                    <mat-select formControlName="assignment">
                      <mat-option *ngFor="let assignment of assignmentsMaster"
                        [value]="assignment.id">{{assignment.name}}</mat-option>
                    </mat-select>
                    <mat-error
                      *ngIf="assignmentForm.get('assignment')?.invalid && assignmentForm.get('assignment')?.touched">
                      Assignment is invalid
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Transaction</mat-label>
                    <div class="uname-input">
                      <input matInput value="TR1213">
                    </div>
                  </mat-form-field>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label> Date</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="date">
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                    <mat-error *ngIf="assignmentForm.get('date')?.invalid && assignmentForm.get('date')?.touched">
                      Date is invalid
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Amount</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="amount">
                    </div>
                    <mat-error *ngIf="assignmentForm.get('amount')?.invalid && assignmentForm.get('amount')?.touched">
                      Amount is invalid
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="col">
                  <!-- <mat-form-field class="full-width">
                    <mat-label>Payment Date</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="paymentDate">
                    </div>
                    <mat-error
                      *ngIf="assignmentForm.get('paymentDate')?.invalid && assignmentForm.get('paymentDate')?.touched">
                      Payment Date is invalid
                    </mat-error>
                  </mat-form-field> -->
                  <mat-form-field class="full-width">
                    <mat-label> Payment Date</mat-label>
                    <input matInput [matDatepicker]="paymentDate" formControlName="paymentDate">
                    <mat-datepicker-toggle matIconSuffix [for]="paymentDate"></mat-datepicker-toggle>
                    <mat-datepicker #paymentDate></mat-datepicker>
                    <mat-error
                      *ngIf="assignmentForm.get('paymentDate')?.invalid && assignmentForm.get('paymentDate')?.touched">
                      Payment Date is invalid
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>

      <!-- Patient -->
      <div class="form-panel">
        <mat-accordion>
          <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Patient
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="form-body">
              <div class="row">
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Patient</mat-label>
                    <mat-select formControlName="patientId" (selectionChange)="handlePatientSelect($event)">
                      <mat-option *ngFor="let patient of patientsMaster"
                        [value]="patient.id">{{patient.name}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                  <mat-error
                    *ngIf="assignmentForm.get('patientId')?.invalid && assignmentForm.get('patientId')?.touched">
                    Patient is invalid
                  </mat-error>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Patient Address</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="patientAddress" readonly>
                    </div>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Contact Person Name</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="cPerson1Name" readonly>
                    </div>
                  </mat-form-field>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Contact Person Phone</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="cPerson1Phone" readonly>
                    </div>
                  </mat-form-field>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Contact Person Name</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="cPerson2Name" readonly>
                    </div>
                  </mat-form-field>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Contact Person Phone</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="cPerson2Phone" readonly>
                    </div>
                  </mat-form-field>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Visit Date</mat-label>
                    <!-- <div class="uname-input">
                      <input matInput formControlName="visitDate">
                    </div> -->
                    <input matInput [matDatepicker]="visitDate" formControlName="visitDate">
                    <mat-datepicker-toggle matIconSuffix [for]="visitDate"></mat-datepicker-toggle>
                    <mat-datepicker #visitDate></mat-datepicker>
                    <mat-error
                      *ngIf="assignmentForm.get('visitDate')?.invalid && assignmentForm.get('visitDate')?.touched">
                      Visit Date is invalid
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Visit Time</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="visitTime">
                    </div>
                    <mat-error
                      *ngIf="assignmentForm.get('visitTime')?.invalid && assignmentForm.get('visitTime')?.touched">
                      Visit Time is invalid
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>

      <!-- Notes -->
      <div class="form-panel">
        <mat-accordion>
          <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Notes
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="form-body">
              <div class="row">
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Professional Notes</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="prNotes">
                    </div>
                  </mat-form-field>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Patient Notes</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="pNotes">
                    </div>
                  </mat-form-field>
                </div>
                <div class="col">
                  <mat-form-field class="full-width">
                    <mat-label>Internal Notes</mat-label>
                    <div class="uname-input">
                      <input matInput formControlName="iNotes">
                    </div>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </mat-card-content>

    <mat-card-actions class="action-btns">
      <button mat-raised-button class="cancel-btn" type="button" (click)="navigateBack()">Cancel</button>
      <button mat-raised-button color="primary" type="submit">Submit</button>
    </mat-card-actions>
  </mat-card>
</form>
